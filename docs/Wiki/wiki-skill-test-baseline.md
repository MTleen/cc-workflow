# ideal-wiki Skill 测试基线

本文档记录 `ideal-wiki` skill 的 TDD 优化过程。

---

## RED Phase: 已知失败模式

以下失败模式来自真实用户反馈（2026-02-22 对话记录）。

### 失败模式 1: 内容过于简略

**触发场景**：生成 Wiki 文档

**观察到的问题**：
- 用户反馈："太简单了太粗略了"
- 流程说明不完整
- P2 之后的阶段被简化为"自动执行"

**Agent 的 rationalization**：
- "核心流程已覆盖，细节可后续补充"
- "用户可能只需要了解大致流程"

**具体表现**：
- quick-start.md 中 P3-P16 被一笔带过
- 每个阶段的输入输出、关键活动描述不足

---

### 失败模式 2: AI 风格写作

**触发场景**：撰写技术文档

**观察到的问题**：
- 用户反馈："语言风格也很 AI 味很重"
- 使用模糊词汇（"非常重要"、"确保"等）
- 缺乏具体数据和可执行步骤

**Agent 的 rationalization**：
- "这是一个概述，不需要太详细"
- "读者应该能够理解大意"

**具体表现**：
- "响应很快" 而非 "响应时间 < 100ms"
- "确保配置正确" 而非 "设置 API_KEY 环境变量"

---

### 失败模式 3: 跳过大纲审查

**触发场景**：开始撰写 Wiki

**观察到的问题**：
- 用户反馈要求："需要 outline 阶段"
- 大纲生成后立即开始写作，未等待用户确认
- 用户无法在大纲阶段调整结构

**Agent 的 rationalization**：
- "大纲看起来合理，可以继续"
- "用户已经确认要生成 Wiki"

**具体表现**：
- 未明确暂停等待用户审查
- 未询问用户是否需要调整文档数量或范围

---

### 失败模式 4: 单文件输出

**触发场景**：从零创建 Wiki

**观察到的问题**：
- 用户反馈："不应该是一个 md 的文档，而是一组"
- 生成单个大文件而非文档集
- 缺少按读者类型/主题的拆分

**Agent 的 rationalization**：
- "合并成一个文件更方便查看"
- "项目简单，不需要多个文档"

**具体表现**：
- 生成 `user-guide.md` 单文件而非 `user-guide/` 目录
- 缺少索引文件和导航结构

---

### 失败模式 5: 使用 ASCII 图

**触发场景**：绘制流程图

**观察到的问题**：
- 用户反馈："不要用 ascii 图，而是用 mermaid、svg"
- 生成的图表使用 ASCII 字符绘制
- 不兼容在线文档工具

**Agent 的 rationalization**：
- "ASCII 图更直观"
- "在 Markdown 中显示正常"

**具体表现**：
- 使用 `-->` 和方框字符绘制流程图
- 缺少 Mermaid 代码块

---

### 失败模式 6: 大纲粒度不足

**触发场景**：Phase 1 大纲设计

**观察到的问题**：
- 用户反馈："当前大纲粒度还不够，还需要包含每个文档的内容大纲"
- 只列出文档标题和主题范围
- 缺少章节结构和关键内容点

**Agent 的 rationalization**：
- "大纲阶段只需要确定文档结构"
- "详细内容在写作阶段确定"

**具体表现**：
- 大纲只有："quick-start.md - 快速开始"
- 缺少："quick-start.md 包含：前置条件、P1-P16 完整流程、验证结果"

---

### 失败模式 7: 描述包含工作流摘要

**触发场景**：Skill 的 description 字段

**观察到的问题**：
- Writing Skills 指出：description 不应总结工作流
- 当前 description："Generates structured wiki documentation sets through a three-phase process"
- 这会让 Agent 跳过阅读 skill 正文

**Agent 的 rationalization**：
- "description 应该说明 skill 做什么"
- "用户需要知道有三阶段流程"

**具体表现**：
```yaml
# 当前（有问题）
description: Generates structured wiki documentation sets through a three-phase process

# 应该是（只描述触发条件）
description: Use when P14 deployment is completed OR creating wiki documentation from scratch
```

---

## Rationalization 汇总表

| Excuse | Reality |
|--------|---------|
| "核心流程已覆盖，细节可后续补充" | 用户需要完整流程说明才能正确使用系统 |
| "这是一个概述，不需要太详细" | 技术文档需要具体数据，不是概述 |
| "大纲看起来合理，可以继续" | 必须等待用户明确确认，不能假设 |
| "合并成一个文件更方便查看" | 文档集支持导航和按需阅读 |
| "ASCII 图更直观" | Mermaid 支持在线文档渲染和交互 |
| "大纲阶段只需要确定文档结构" | 大纲应包含章节结构，让用户预判内容 |
| "description 应该说明 skill 做什么" | description 只应描述触发条件，正文才有工作流 |

---

## 压力场景设计

### 场景 1: 时间压力 + 简单项目

**设定**：
- 用户说"简单生成一下 wiki 就行"
- 项目只有 2 个模块
- 时间紧迫，暗示要快

**测试点**：
- 是否跳过大纲审查？
- 是否简化内容？
- 是否使用单文件？

### 场景 2: 复杂项目 + 信息过载

**设定**：
- 项目有 10+ 模块
- 用户提供了大量背景信息
- 没有明确指导

**测试点**：
- 是否动态调整文档数量？
- 是否正确评估复杂度？
- 是否创建多层级结构？

### 场景 3: 增量更新 + 沉没成本

**设定**：
- 已有 Wiki 文档
- 只需要更新一小部分
- 旧的 Wiki 使用了 ASCII 图

**测试点**：
- 是否只更新受影响部分？
- 是否保持格式一致（不混用 ASCII/Mermaid）？
- 是否更新大纲文件？

---

## GREEN Phase: 修复清单

基于上述失败模式，需要修复的 skill 内容：

| 优先级 | 问题 | 修复方案 |
|--------|------|----------|
| P0 | description 包含工作流摘要 | 改为只描述触发条件 |
| P0 | 跳过大纲审查 | 添加明确暂停点和确认要求 |
| P0 | 内容简略 | 在写作原则中强调具体数据要求 |
| P1 | 大纲粒度不足 | 大纲模板要求包含章节结构 |
| P1 | 单文件输出 | 明确禁止单文件，要求文档集 |
| P2 | ASCII 图 | 在技术标准中明确要求 Mermaid |

---

## 测试记录

### 基线测试（未修复）

**日期**：2026-02-22
**场景**：完整 Wiki 生成

**观察到的问题**：
1. [x] 内容过于简略
2. [x] AI 风格写作
3. [ ] 跳过大纲审查（已添加 Phase 1 确认步骤，但未强制）
4. [x] 单文件输出（初期表现）
5. [ ] ASCII 图（已改为 Mermaid）
6. [x] 大纲粒度不足
7. [ ] description 包含工作流摘要

### 修复后测试

**日期**：2026-02-22
**修复内容**：

| 失败模式 | 修复状态 | 修复内容 |
|----------|----------|----------|
| #1 内容简略 | ✅ 已修复 | 添加"具体数据 vs 模糊描述"表格，禁止简化流程 |
| #2 AI 风格 | ✅ 已修复 | 添加禁止词汇对照表，强调正式技术风格 |
| #3 跳过大纲 | ✅ 已修复 | 添加 IRON LAW 强制确认，反 rationalization 列表 |
| #4 单文件 | ✅ 已修复 | 添加 IRON LAW 禁止单文件，明确最少文档数 |
| #5 ASCII 图 | ✅ 已修复 | 2.3 图表要求明确"必须使用 Mermaid，禁止 ASCII 图" |
| #6 大纲粒度 | ✅ 已修复 | 1.3 大纲格式要求包含"章节结构"字段 |
| #7 description | ✅ 已修复 | 移除工作流摘要，只保留触发条件 |

**新增的反 rationalization 机制**：
- Overview 添加"违反以下任何规则 = 违反 skill 精神"
- 1.4 添加 IRON LAW 和"无例外"列表
- 2.2 添加 IRON LAW 禁止单文件
- Common Mistakes 扩展为 12 条
- 新增 Red Flags 章节，列出 5 个危险信号

---

## REFACTOR Phase: 漏洞分析

### 潜在漏洞 1: 大纲确认后立即撰写所有内容 ✅ 已修复

**场景**：用户确认大纲后，Agent 一次性撰写所有文档，不检查用户是否需要中途调整

**可能的 rationalization**：
- "用户已经确认大纲，可以直接完成"
- "中途询问会打断流程"
- "为了效率跳过样例确认"

**修复内容**：
- 添加 2.5 渐进式撰写（样例确认）章节
- 添加 IRON LAW 强制第一篇内容文档后暂停
- 添加用户反馈处理表
- 添加批量撰写阶段的进度报告机制

**修复状态**：✅ 已修复

### 潜在漏洞 2: 复杂度评估过于主观

**场景**：Agent 可能低估复杂度，导致文档数量不足

**可能的 rationalization**：
- "这个项目实际上比较简单"
- "4-6 篇文档已经足够"

**修复建议**：
- 可选：添加复杂度评分表（如 1-5 分制），让用户可见评估依据
- 当前状态：暂不修复，依赖 Agent 判断

### 潜在漏洞 3: 审查阶段被跳过

**场景**：时间压力下，Agent 可能跳过 Phase 3 质量审查

**可能的 rationalization**：
- "内容已经很完善，不需要审查"
- "用户可能急着要结果"

**修复建议**：
- 已在 Quality Checklist 中强调 Phase 3 必须执行
- Common Mistakes 中已包含"生成后不审查"

### 当前 REFACTOR 结论

**已修复的漏洞**：
- 潜在漏洞 #1（渐进式撰写）已添加样例确认机制

**无需立即修复的漏洞**：
- 潜在漏洞 2-3 均已有部分防护
- 当前 skill 已经包含足够的反 rationalization 机制

**待观察**：
- 在下次实际 Wiki 生成中观察是否出现新的失败模式
- 如果发现新的 rationalization，再补充到 Red Flags 列表

---

## 迭代记录

### 迭代 1: 基础修复（7 个失败模式）

**修复内容**：
- description 移除工作流摘要
- 大纲确认强制化
- 具体数据要求
- 文档集强制化
- Mermaid 强制化
- 大纲章节结构
- Common Mistakes 扩展

### 迭代 2: 渐进式撰写（漏洞 #1）

**修复内容**：
- 添加 2.5 样例确认机制
- 添加 Mermaid 流程图
- 添加用户反馈处理表
- Red Flags 新增 2 条

