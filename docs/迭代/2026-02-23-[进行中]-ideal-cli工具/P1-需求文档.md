---
需求名称: ideal-cli 工作流初始化工具
需求类型: software-feature
创建时间: 2026-02-23
当前阶段: P1
风险等级: 中
---

# P1-需求文档：ideal-cli 工作流初始化工具

## 一、需求背景

### 1.1 现状分析

当前 CC-Workflow 项目已形成完整的 15 阶段开发流程（P1-P15），包含 agents 角色定义、skills 流程规范和文档模板体系。然而，新用户在使用这套工作流时面临以下障碍：

1. **目录结构复杂**：需手动创建 `.claude/agents/`、`.claude/skills/`、`docs/迭代/`、`docs/Wiki/` 等多级目录
2. **配置文件繁多**：需复制并定制 `CLAUDE.md`、`project-config.md` 等配置文件
3. **模板分散**：agents 和 skills 文件分散在多个目录，手动复制易遗漏
4. **版本管理困难**：工作流模板更新后，已有项目难以同步最新版本

### 1.2 问题陈述

上述问题导致以下影响：

- 新用户上手门槛高，需花费大量时间理解目录结构和配置方式
- 不同团队成员初始化方式不一致，导致项目结构差异
- 工作流模板更新后，各项目版本参差不齐，难以统一维护

### 1.3 目标概述

构建 `ideal-cli` 命令行工具，实现以下目标：

1. **降低上手门槛**：通过交互式引导，一键完成工作流初始化
2. **统一初始化流程**：确保所有项目采用一致的目录结构和配置
3. **简化版本更新**：提供增量更新机制，支持冲突检测与选择性合并

---

## 二、目标用户

| 用户角色 | 使用场景 | 核心需求 |
|----------|----------|----------|
| 新团队成员 | 首次接触工作流，需快速搭建开发环境 | 简单易用的初始化流程，清晰的引导提示 |
| 项目负责人 | 为新项目或多个项目配置工作流 | 批量初始化能力，自定义配置选项 |
| 外部用户 | 开源社区或其他团队希望采用本工作流 | 独立安装，无需内部权限，完整的文档支持 |

---

## 三、功能需求

### 3.1 功能清单

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| F001 | ideal init | 交互式引导创建目录结构、复制 agents/skills、生成配置文件 | P0 |
| F002 | ideal config | 查看/修改项目配置信息 | P1 |
| F003 | ideal update | 更新 agents/skills 到最新版本，支持冲突检测 | P1 |
| F004 | ideal doctor | 检查工作流配置完整性和有效性 | P1 |
| F005 | ideal --help | 显示命令帮助信息 | P0 |

### 3.2 功能详细说明

#### F001 ideal init

**核心命令**，执行完整的初始化流程。

**执行步骤：**

1. 检测当前目录是否已存在工作流配置
2. 从 GitHub 仓库拉取最新模板
3. 交互式引导用户配置项目信息：
   - 项目名称（默认：当前目录名）
   - Git 主分支名称（默认：main）
   - 技术栈类型（React/Vue/Node.js/Python/其他）
   - 是否创建示例需求文档（默认：否）
4. 创建目录结构：
   ```
   .claude/
   ├── agents/
   │   ├── pm.md
   │   ├── architect.md
   │   ├── dev.md
   │   ├── qa.md
   │   ├── analyst.md
   │   └── tech-writer.md
   ├── skills/
   │   ├── ideal-requirement/
   │   ├── ideal-dev-solution/
   │   ├── ideal-dev-plan/
   │   ├── ideal-test-case/
   │   ├── ideal-dev-exec/
   │   ├── ideal-code-review/
   │   ├── ideal-test-exec/
   │   ├── ideal-wiki/
   │   ├── ideal-flow-control/
   │   └── ideal-debugging/
   └── project-config.md
   docs/
   ├── 迭代/
   └── Wiki/
   CLAUDE.md
   ```
5. 生成配置文件并提示后续操作

**交互设计：**

- 支持一键回车选择默认值
- 支持输入 `skip` 跳过可选配置项
- 离线环境时报错并提示需要网络连接

#### F002 ideal config

**配置管理命令**，用于查看和修改项目配置。

**子命令：**

| 命令 | 功能 |
|------|------|
| `ideal config list` | 显示当前所有配置项 |
| `ideal config get <key>` | 获取指定配置项的值 |
| `ideal config set <key> <value>` | 设置指定配置项的值 |

#### F003 ideal update

**更新命令**，同步最新版本的 agents 和 skills。

**执行逻辑：**

1. 从 GitHub 仓库获取最新版本信息
2. 对比本地文件与远程版本的差异
3. 检测用户是否对本地文件进行了修改
4. 若存在修改，提示用户选择：
   - 保留本地修改
   - 使用远程版本
   - 手动合并后继续
5. 执行更新操作并记录变更日志

#### F004 ideal doctor

**诊断命令**，检查工作流配置的完整性和有效性。

**检查项：**

| 检查类别 | 检查内容 |
|----------|----------|
| 目录结构 | 必需目录是否存在 |
| 配置文件 | CLAUDE.md、project-config.md 格式是否正确 |
| 依赖环境 | Node.js、Python 环境是否满足要求 |
| 版本兼容性 | agents/skills 版本与 CLI 版本是否兼容 |

**输出格式：**

```
✓ 目录结构完整
✓ 配置文件有效
⚠ Python 版本过低（当前 3.8，建议 3.10+）
✓ 版本兼容

诊断结果：3 项通过，1 项警告
```

#### F005 ideal --help

**帮助命令**，显示使用说明。

**输出内容：**

- 命令列表及简要说明
- 常用示例
- 版本信息

---

## 四、非功能需求

| 维度 | 要求 |
|------|------|
| 性能 | 初始化命令执行时间不超过 30 秒（网络正常情况下） |
| 可用性 | 提供清晰的错误提示和恢复建议，支持 `--verbose` 参数输出详细日志 |
| 安全性 | 不存储敏感信息，GitHub 拉取使用 HTTPS 协议 |
| 兼容性 | 支持 Node.js 18+，兼容 macOS、Linux、Windows 系统 |

---

## 五、约束条件

| 约束类型 | 说明 |
|----------|------|
| 技术约束 | 使用 Node.js 开发，通过 npm 分发；模板文件存储于 GitHub 仓库 |
| 时间约束 | 核心功能（init、help）优先交付，其他功能迭代完善 |
| 资源约束 | 单人开发，依赖现有工作流模板资源 |

---

## 六、验收标准

### 6.1 功能验收

- [ ] 用户可通过 `npm install -g ideal-cli` 全局安装
- [ ] 执行 `ideal init` 可完成完整的目录结构创建和配置文件生成
- [ ] 交互式引导支持选择默认值或跳过
- [ ] 离线环境执行 `ideal init` 时显示明确的错误提示
- [ ] 执行 `ideal config list` 可显示当前所有配置项
- [ ] 执行 `ideal update` 可检测并提示文件冲突
- [ ] 执行 `ideal doctor` 可完成所有检查项并输出诊断结果
- [ ] 执行 `ideal --help` 显示完整的命令说明

### 6.2 非功能验收

- [ ] `ideal init` 在网络正常情况下执行时间不超过 30 秒
- [ ] 支持 macOS、Linux、Windows 三大平台
- [ ] 错误提示信息清晰，包含恢复建议

---

## 七、风险评估

| 风险项 | 影响程度 | 发生概率 | 应对措施 |
|--------|----------|----------|----------|
| GitHub 访问受限 | 高 | 中 | 提供镜像源配置选项，支持 Gitee 等国内平台 |
| 模板文件格式变更 | 中 | 低 | 在 CLI 中实现版本兼容性检查 |
| 跨平台兼容性问题 | 中 | 中 | 在三大平台上进行充分测试 |
| 用户自定义模板被覆盖 | 高 | 中 | 实现冲突检测机制，更新前强制确认 |

---

## 八、参考资料

- [Commander.js](https://github.com/tj/commander.js) - Node.js CLI 框架
- [Inquirer.js](https://github.com/SBoudrias/Inquirer.js) - 交互式命令行界面
- [cc-workflow 项目](https://github.com/anthropics/cc-workflow) - 本工作流模板来源

---

*文档版本: v1.0*
*创建时间: 2026-02-23*
*作者: Claude Code*
