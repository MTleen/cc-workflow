---
story_id: 002
title: 常量与日志工具
status: completed
depends_on: [001]
---

# Story 002: 常量与日志工具

## 上下文

### 需求来源
> 来源：P1-需求文档.md#三、功能需求

CLI 工具需要提供清晰的错误提示和恢复建议，支持 `--verbose` 参数输出详细日志。

### 技术方案
> 来源：P3-技术方案.md#二、系统架构

- 模板来源：从 GitHub 仓库 `ideal-lab/best-practices/dev-workflow/` 拉取
- 日志模块：统一输出格式，支持彩色

### 相关代码

已完成的基础类型定义（Story 001）：
- `src/types/config.ts` - 配置类型
- `src/types/template.ts` - 模板类型
- `src/types/doctor.ts` - 诊断类型

## 任务清单

- [x] M012-1: 定义默认值常量
  - [x] 创建 src/constants/defaults.ts
  - [x] 定义 DEFAULT_REPO = 'ideal-lab'
  - [x] 定义 DEFAULT_BRANCH = 'main'
  - [x] 定义 DEFAULT_TEMPLATE_PATH = 'best-practices/dev-workflow'
- [x] M012-2: 定义提示信息
  - [x] 创建 src/constants/messages.ts
  - [x] 定义成功消息模板
  - [x] 定义错误消息模板
  - [x] 定义警告消息模板
  - [x] 创建 src/constants/index.ts 导出
- [x] M013-1: 实现 Logger 类
  - [x] 创建 src/utils/logger.ts
  - [x] 实现 info, success, warn, error 方法
  - [x] 支持 --verbose 模式
- [x] M013-2: 实现颜色输出
  - [x] 安装 chalk 依赖
  - [x] 实现彩色日志输出
- [x] M013-3: 实现 Spinner
  - [x] 安装 ora 依赖
  - [x] 实现加载动画

## 验收标准

### 功能验收
- [x] Logger.info() 输出蓝色信息
- [x] Logger.success() 输出绿色成功
- [x] Logger.warn() 输出黄色警告
- [x] Logger.error() 输出红色错误
- [x] Spinner 正常启动和停止

### 代码质量
- [x] 常量命名规范（UPPER_SNAKE_CASE）
- [x] 日志格式统一
- [x] 类型定义完整

## 实现笔记

**完成时间**: 2026-02-23

**已创建文件**:
- `src/constants/defaults.ts` - 默认值常量（仓库、分支、模板路径等）
- `src/constants/messages.ts` - 消息模板（成功、错误、警告、提示）
- `src/constants/index.ts` - 常量导出
- `src/utils/logger.ts` - Logger 类（支持彩色输出和 verbose 模式）
- `src/utils/spinner.ts` - Spinner 工具（加载动画）
- `src/utils/index.ts` - 工具导出
- `tests/logger.test.ts` - Logger 测试（8 个测试用例）

**验证结果**:
- TypeScript 类型检查: ✅ 通过
- 构建: ✅ 成功
- 测试: ✅ 9 个测试通过
