---
story_id: 007
title: CLI 入口与命令注册
status: completed
depends_on: [002]
---

# Story 007: CLI 入口与命令注册

## 上下文

### 需求来源
> 来源：P1-需求文档.md#三、功能需求

- 安装方式：npm 全局安装 (`npm install -g ideal-cli`)
- 支持命令：init、config、update、doctor、--help

### 技术方案
> 来源：P3-技术方案.md#二、系统架构

- CLI 框架：Commander.js
- 程序名称：ideal
- 版本信息：从 package.json 读取

### 相关代码

已完成的模块（Story 002）：
- `src/utils/logger.ts` - 日志工具
- `src/constants/messages.ts` - 提示信息

## 任务清单

- [x] M022-1: 实现 CLI 入口
  - [x] 创建 src/index.ts
  - [x] 配置 Commander 程序
  - [x] 设置程序名称为 'ideal'
  - [x] 配置 package.json bin 字段
- [x] M022-2: 实现命令注册
  - [x] 创建 src/commands/index.ts
  - [x] 实现 registerCommands(program) 函数
  - [x] 预留命令注册位置
- [x] M022-3: 实现版本和帮助
  - [x] 配置 --version 选项
  - [x] 配置 --help 选项
  - [x] 自定义帮助信息格式
- [x] M027-1: 配置帮助信息
  - [x] 添加命令描述
  - [x] 添加参数说明
- [x] M027-2: 实现示例输出
  - [x] 添加使用示例到帮助信息
  - [x] 示例：`ideal init`、`ideal config list`、`ideal doctor`

## 验收标准

### 功能验收
- [x] `ideal --version` 输出版本号
- [x] `ideal --help` 输出帮助信息
- [x] 帮助信息包含所有命令说明
- [x] 帮助信息包含使用示例

### 代码质量
- [x] 命令描述清晰
- [x] bin 字段配置正确
- [x] 类型定义完整

## 实现笔记

**完成时间**: 2026-02-23

**已创建/修改文件**:
- `src/index.ts` - CLI 主入口
  - 使用 Commander.js 配置程序
  - 程序名称：ideal
  - 配置 -v, --version 选项
  - 配置 -h, --help 选项
  - 添加自定义帮助信息和示例
- `src/commands/index.ts` - 命令注册
  - 实现 registerCommands(program) 函数
  - 预留 init, config, update, doctor 命令位置
  - 使用 HELP_* 消息常量作为命令描述

**帮助信息输出**:
```
Usage: ideal [options] [command]

ideal-cli - Ideal Lab 开发工作流初始化工具

Options:
  -v, --version   输出版本号
  -h, --help      显示帮助信息

Commands:
  init            初始化项目工作流配置
  config          查看或修改项目配置
  update          更新工作流模板到最新版本
  doctor          检查工作流配置完整性和有效性
  help [command]  display help for command

Examples:
  $ ideal init              交互式初始化工作流
  $ ideal config list       查看当前配置
  $ ideal doctor            检查配置完整性
```

**验证结果**:
- TypeScript 类型检查: ✅ 通过
- 构建: ✅ 成功
- CLI 运行: ✅ 正常
