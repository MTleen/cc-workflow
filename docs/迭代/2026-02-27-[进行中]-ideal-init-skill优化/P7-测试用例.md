---
需求名称: ideal-init skill 优化 - 职责重构与功能补全
关联需求: P1-需求文档.md
关联计划: P5-编码计划.md
创建时间: 2026-02-27
当前阶段: P7
---

# P7-测试用例：ideal-init skill 优化

## 测试概述

| 类型 | 数量 | 占比 |
|------|------|------|
| 功能测试 | 7 | 50% |
| 边界测试 | 4 | 29% |
| 异常测试 | 3 | 21% |
| **总计** | **14** | **100%** |

---

## 功能测试

### TC-FUNC-001: 已初始化检测 - 未初始化项目

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-FUNC-001 |
| **用例名称** | 已初始化检测 - 未初始化项目 |
| **优先级** | P0 |
| **前置条件** | 项目根目录下不存在 `.claude/project-config.md` |

**测试步骤**:
1. 触发 `/ideal-init`
2. 检查是否跳过已初始化提示
3. 验证是否进入项目探测步骤

**预期结果**:
- 不显示"已初始化"提示
- 直接进入 Step 2 项目探测

---

### TC-FUNC-002: 已初始化检测 - 已初始化项目

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-FUNC-002 |
| **用例名称** | 已初始化检测 - 已初始化项目 |
| **优先级** | P0 |
| **前置条件** | 项目根目录下存在 `.claude/project-config.md` 且包含 CC-Workflow 标记 |

**测试步骤**:
1. 触发 `/ideal-init`
2. 检查是否显示"已初始化"提示
3. 选择"重新配置"
4. 验证是否进入项目探测步骤

**预期结果**:
- 显示"检测到项目已接入 CC-Workflow"
- 提供重新配置/取消选项
- 选择重新配置后进入 Step 2 项目探测

---

### TC-FUNC-003: 项目探测 - Node.js 项目

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-FUNC-003 |
| **用例名称** | 项目探测 - Node.js 项目 |
| **优先级** | P0 |
| **前置条件** | 项目根目录下存在 `package.json` |

**测试步骤**:
1. 触发 `/ideal-init`
2. 检查探测结果

**预期结果**:
- 语言类型显示为 `Node.js`
- 测试命令推断为 `npm test`
- 构建命令推断为 `npm run build`

---

### TC-FUNC-004: 项目探测 - Python 项目

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-FUNC-004 |
| **用例名称** | 项目探测 - Python 项目 |
| **优先级** | P0 |
| **前置条件** | 项目根目录下存在 `requirements.txt` 或 `pyproject.toml` |

**测试步骤**:
1. 触发 `/ideal-init`
2. 检查探测结果

**预期结果**:
- 语言类型显示为 `Python`
- 测试命令推断为 `pytest`

---

### TC-FUNC-005: 用户确认 - 修正探测结果

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-FUNC-005 |
| **用例名称** | 用户确认 - 修正探测结果 |
| **优先级** | P0 |
| **前置条件** | 已完成项目探测步骤 |

**测试步骤**:
1. 查看探测结果展示
2. 输入修正信息（如修改项目名称）
3. 验证修正是否生效

**预期结果**:
- 探测结果以表格形式展示
- 用户可以修改任意探测项
- 修正后的值在后续步骤中使用

---

### TC-FUNC-006: 配置生成 - 创建新文件

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-FUNC-006 |
| **用例名称** | 配置生成 - 创建新文件 |
| **优先级** | P0 |
| **前置条件** | `.claude/project-config.md` 不存在 |

**测试步骤**:
1. 完成用户确认步骤
2. 检查是否生成 `.claude/project-config.md`
3. 验证文件内容格式

**预期结果**:
- 创建 `.claude/project-config.md` 文件
- 文件包含 YAML Front Matter
- 文件包含探测结果填充的配置项

---

### TC-FUNC-007: CLAUDE.md 追加 - 追加到现有文件

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-FUNC-007 |
| **用例名称** | CLAUDE.md 追加 - 追加到现有文件 |
| **优先级** | P0 |
| **前置条件** | `CLAUDE.md` 已存在且不包含 CC-Workflow 标记 |

**测试步骤**:
1. 完成配置生成步骤
2. 检查 `CLAUDE.md` 内容
3. 验证追加内容格式

**预期结果**:
- 原有内容保留
- 末尾追加"CC-Workflow 工作流集成"章节
- 包含初始化时间和版本信息

---

## 边界测试

### TC-EDGE-001: 项目探测 - 无法识别的项目类型

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EDGE-001 |
| **用例名称** | 项目探测 - 无法识别的项目类型 |
| **优先级** | P1 |
| **前置条件** | 项目根目录下无任何特征文件 |

**测试步骤**:
1. 触发 `/ideal-init`
2. 检查探测结果

**预期结果**:
- 语言类型默认为 `Other`
- 测试/构建命令为空
- 用户可在确认步骤修正

---

### TC-EDGE-002: 用户确认 - 全部使用默认值

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EDGE-002 |
| **用例名称** | 用户确认 - 全部使用默认值 |
| **优先级** | P1 |
| **前置条件** | 已完成项目探测步骤 |

**测试步骤**:
1. 直接确认"正确"
2. 验证后续步骤使用探测结果

**预期结果**:
- 无需修改任何值
- 使用探测的默认值生成配置

---

### TC-EDGE-003: CLAUDE.md 追加 - 文件不存在

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EDGE-003 |
| **用例名称** | CLAUDE.md 追加 - 文件不存在 |
| **优先级** | P1 |
| **前置条件** | `CLAUDE.md` 不存在 |

**测试步骤**:
1. 完成配置生成步骤
2. 检查 `CLAUDE.md` 是否创建

**预期结果**:
- 创建完整的 `CLAUDE.md` 文件
- 包含工作流集成章节

---

### TC-EDGE-004: 完整性校验 - 缺少目录

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EDGE-004 |
| **用例名称** | 完整性校验 - 缺少目录 |
| **优先级** | P1 |
| **前置条件** | `docs/迭代/` 或 `docs/Wiki/` 目录不存在 |

**测试步骤**:
1. 完成配置生成和 CLAUDE.md 追加
2. 检查完整性校验报告

**预期结果**:
- 报告显示警告：目录不存在
- 提示运行 `ideal init` 创建目录

---

## 异常测试

### TC-EXC-001: CLAUDE.md 已包含工作流标记

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EXC-001 |
| **用例名称** | CLAUDE.md 已包含工作流标记 |
| **优先级** | P1 |
| **前置条件** | `CLAUDE.md` 已包含 `## CC-Workflow 工作流集成` |

**测试步骤**:
1. 触发 `/ideal-init`
2. 执行到 CLAUDE.md 追加步骤
3. 检查处理方式

**预期结果**:
- 检测到已存在工作流标记
- 询问用户是否更新
- 不重复追加内容

---

### TC-EXC-002: Git 未初始化

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EXC-002 |
| **用例名称** | Git 未初始化 |
| **优先级** | P2 |
| **前置条件** | 项目根目录下不存在 `.git` 目录 |

**测试步骤**:
1. 触发 `/ideal-init`
2. 检查探测结果
3. 检查完整性校验报告

**预期结果**:
- 探测结果 `isGitRepo: false`
- 完整性校验提示"Git 未初始化"

---

### TC-EXC-003: 用户中途取消

| 项目 | 内容 |
|------|------|
| **用例编号** | TC-EXC-003 |
| **用例名称** | 用户中途取消 |
| **优先级** | P2 |
| **前置条件** | 已触发 `/ideal-init` |

**测试步骤**:
1. 触发 `/ideal-init`
2. 在任意步骤输入"取消"

**预期结果**:
- 流程终止
- 不生成任何文件（可选：保存草稿）

---

## 覆盖率统计

| 功能点 | 覆盖用例 | 覆盖状态 |
|--------|----------|----------|
| 已初始化检测 | TC-FUNC-001, TC-FUNC-002 | ✅ |
| 项目探测 | TC-FUNC-003, TC-FUNC-004, TC-EDGE-001 | ✅ |
| 用户确认 | TC-FUNC-005, TC-EDGE-002 | ✅ |
| 配置生成 | TC-FUNC-006 | ✅ |
| CLAUDE.md 追加 | TC-FUNC-007, TC-EDGE-003, TC-EXC-001 | ✅ |
| 完整性校验 | TC-EDGE-004, TC-EXC-002 | ✅ |
| 初始化报告 | TC-FUNC-001 (隐含) | ✅ |
| 用户取消 | TC-EXC-003 | ✅ |

**覆盖率**: 8/8 功能点 = **100%**

---

*文档版本: v1.0*
*创建时间: 2026-02-27*
*作者: Claude Code*
